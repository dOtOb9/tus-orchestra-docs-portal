# ユーザーガイド

## はじめに
このガイドは、東京理科大学オーケストラにおける出欠管理システムの使い方を説明するものです。本システムは、各パートリーダーやインスペクターが効率的に出欠を管理できるよう設計されています。練習日程の管理、出席登録、認証コードの生成など、さまざまな機能が自動化されており、団員は専用フォームから簡単に出欠登録を行うことができます。

また、出欠管理のフローが明確にされ、セクションごとの出欠管理や乗り番リストの作成などもシステム上で一元管理できるため、練習状況の把握がスムーズに行えます。

---

## フォルダ構造
```bash
管理フォルダ/
├── 管理用ファイル
└── 出欠表フォルダ/
       ├── Tutti出欠表ファイル
       ├── 弦楽器出欠表ファイル
       ├── 木管楽器出欠表ファイル
       ├── 金管楽器出欠表ファイル
       └── 打楽器出欠表ファイル
```

### 出欠表フォルダ
このフォルダは、全ての出欠表ファイルを管理するフォルダです。主に、**パートリーダーが編集権限を持つ**ことを想定しています。出欠表ファイルは、`Tutti`、`弦楽器`、`木管楽器`、`金管楽器`、`打楽器`のように、セクション毎に分かれています。このようにすることで、セクション間で練習内容が異なる場合でも、それぞれの**セクション毎に出欠を管理**することができます。各出欠表ファイルの扱い方は、**すべて同じ**です。出欠表ファイルの詳しい扱い方は、[出欠登録](#出席登録)で解説しています。

### 管理フォルダ
このフォルダは、出欠表フォルダと練習予定管理ファイルを管理するフォルダです。主に、**インスペクターが編集権限を持つ**ことを想定しています。練習予定管理ファイルは、**乗り番のメンバーの設定**や、**各出欠表に反映する練習コマの管理**を行います。練習予定管理ファイルの詳しい扱い方は、[乗り番リストの作成](#乗り番リストの作成)と[練習予定の追加](#練習予定の追加)で解説しています。

:::tip 権限の共有はフォルダですると良いよ！
すべてのファイルはスプレッドシート形式で、権限の共有はフォルダ単位で行います。これにより、権限を与えられたユーザーは、フォルダ内の全ファイルに簡単にアクセスできるようになります。

![フォルダの共有](/img/shared_folder.png)
:::

---

## 使い方
### 乗り番リストの作成
使用する前の準備として、`管理用`ファイル内の`乗り番`シートで、前曲、中曲、メイン曲それぞれの乗り番の団員にチェックを入れる必要があります。これは、出欠管理システム内の他にも、Discordボットでの練習連絡機能の利用時にシステム上で使用されます。

![乗り番の登録](/img/register_member.png)


### 練習予定の追加

Discordボットの機能により、練習連絡を送信すると自動的に出欠管理システムに練習情報が通知され、自動化フローが開始します。通知された練習情報は、`管理用ファイル`に記録され、出欠列の生成時や認証コードの生成時、出席登録時にシステム側が参照します。インスペクターなど、`管理用ファイル`の編集権限がある団員はDiscordボットによる練習連絡の送信後、本システムに通知された練習情報を編集することもできます。

:::tip 練習予定の画面について
`練習予定`シートは、`日付`、`練習コマ`、`練習曲`、`列名`、`セクション`からなります。練習当日になると、システムは`日付`、`練習コマ`、`練習曲`、`セクション`の情報から対応した出欠表に列を生成し、生成した列の位置情報を`列名`に入力します。その後、それらの情報を元に出席登録のフローを開始します。

![練習予定の画面](/img/schedule_widget.png)
:::warning 練習当日は練習予定シートを操作するな！
以上のように、システムは練習予定シートに入力された情報を元に動作します。練習当日に練習予定シートの情報を操作すると、システムが予期せぬ動作をする場合があるので、練習当日はこの練習予定シートは編集しない方が無難です。
:::

:::info 手動での出欠列の追加・削除
以上のように、基本的には練習連絡の情報を元に自動で出欠列が追加されますが、合宿分の出欠の追加や演奏会後の出欠表のリセットなど、柔軟に出欠列を追加したい場合もあるでしょう。その場合は、以下のGIF画像のようにスプレッドシートを直接操作することで、出欠列を追加・削除することができます。ただし、**この方法では出席登録の機能は動作しません**。

![出欠列の追加](/img/add_column.png)

:::warning 練習当日は気をつけろ！
練習当日は、出席登録の機能が作動している関係で、出欠列を追加すると間違った位置に出席が記録される場合があります。これを回避するためには、`H列`の左側から列を挿入する必要があります。ただ、基本的には練習のない日に列の追加・削除をする方が無難です。
:::

### 出席登録
練習日当日になると、専用のDiscordチャネルに認証コードが送信されます。0:00〜1:00の間、12:00〜13:00の間の2回送信され、前者は前半の2コマ、後者は後半の2コマの出席登録に使用されます。

出席登録は、専用のフォームによって実行します。専用フォームは、Discordボットによる練習連絡メッセージに付随する、出席認証と表示されたリンクを開くことで利用することができます。

午前に登録すると前半2コマ、午後に登録すると後半2コマの出席が登録されます。遅刻や早退、冠婚葬祭、学業など、既に欠席以外の値が入力されている場合には、フォームには登録完了と表示されていても出席とは入力されません。

出欠表のスプレッドシートは、パートリーダー等は出欠表の値自体を手動で編集することもできます。しかし、基本的には団員一人一人が出席登録を行った方が手間がかからないと思います。

<iframe class="google-slide" src="https://docs.google.com/presentation/d/e/2PACX-1vTn77krbW1vgTv222aK2KgBxowgvzy50Iwme7lgCEYTCwxoiZl64bxHJ1db6vOv9Jjj28qD8uAYIC4X/embed?start=false&loop=false&delayms=3000" frameborder="0" width="960" height="569" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>

---

## 自動化の流れ

### 練習日程管理
1. Discord Botによる練習連絡送信時に`練習予定の管理`ファイルに練習の情報が登録される。
2. 毎日0:00~1:00に、登録された情報に従って出欠列が生成される。練習日であれば、欠席と降り番が入力される。
3. 0:00〜1:00と12:00〜13:00に認証コードの置換と、Discordチャネルへの送信がされる。

<iframe class="google-slide" src="https://docs.google.com/presentation/d/1TKqU5a3g_LNte9_EeBZlhY3dOOk5dA70BJedK3FYSRA/embed?start=false&loop=false&delayms=3000" frameborder="0" width="960" height="569" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>

---

### 出欠登録
1. Discordチャネルに送信された認証コードに従って、各団員がDiscord Bot内のフォームからコードを送信
2. `練習予定の管理`ファイルに登録された情報に従って、各出欠表に出席が自動入力される。
3. 出欠表ファイルの編集権限を持っている団員であれば手動で入力も可能。
<iframe class="google-slide" src="https://docs.google.com/presentation/d/1R2IJQwpFF_m-TNYZly9yFdSlpkNPoJQYSETRa7VES6w/embed?start=false&loop=false&delayms=3000" frameborder="0" width="960" height="569" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>